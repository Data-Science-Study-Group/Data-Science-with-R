---
title: "RQ5"
author: "Sumit Kundu"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Final Analysis

__5. Who are the top 100 customers that are most profitable in terms of revenue generation for each shop?__ <br />

__Analysis__

__1) Data preparation__
In order to find out the top 100 customers that are most profitable in terms of revenue generation, we generated loyality score of the customers for each shop. We assumed that more money the customers spend at a shop, more loyal they are to the shop. Based on this assumption we defined loyality score as the contribution of each customer towards the revenue of each shop i.e ratio of money spent by the customer at a shop and total revene generated by a shop.

```{r echo=TRUE, message=FALSE}
## Call the packages
library(tidyverse)
library(ggplot2)
library("RColorBrewer")
library(plotly)

file_path <- "/home/sumit/Data-Science-with-R/Input Dataset/Cleaned Dataset/Supermarket_DataCleaned.csv"
supermarket_data_clean <- read_csv(file_path)

## Calculate the revenue generated for each shop
revenue_shop_1 <- sum(supermarket_data_clean$amount_purchased_shop_1)
revenue_shop_2 <- sum(supermarket_data_clean$amount_purchased_shop_2)
revenue_shop_3 <- sum(supermarket_data_clean$amount_purchased_shop_3)
revenue_shop_4 <- sum(supermarket_data_clean$amount_purchased_shop_4)
revenue_shop_5 <- sum(supermarket_data_clean$amount_purchased_shop_5)

## Calculate the Loyality Score of the customers for each shop based on their contribution to the revenue of the shop
supermarket_data_clean$loyality_score_shop_1 <- with(supermarket_data_clean, amount_purchased_shop_1/revenue_shop_1 * 100)
supermarket_data_clean$loyality_score_shop_2 <- with(supermarket_data_clean, amount_purchased_shop_2/revenue_shop_2 * 100)
supermarket_data_clean$loyality_score_shop_3 <- with(supermarket_data_clean, amount_purchased_shop_3/revenue_shop_3 * 100)
supermarket_data_clean$loyality_score_shop_4 <- with(supermarket_data_clean, amount_purchased_shop_4/revenue_shop_4 * 100)
supermarket_data_clean$loyality_score_shop_5 <- with(supermarket_data_clean, amount_purchased_shop_5/revenue_shop_5 * 100)

## Sort the column - Loyality Score for each shop in descending order and generate a list of top 100 customers
shop_1 <- head(order(supermarket_data_clean$loyality_score_shop_1, decreasing = TRUE), 100)
shop_2 <- head(order(supermarket_data_clean$loyality_score_shop_2, decreasing = TRUE), 100)
shop_3 <- head(order(supermarket_data_clean$loyality_score_shop_3, decreasing = TRUE), 100)
shop_4 <- head(order(supermarket_data_clean$loyality_score_shop_4, decreasing = TRUE), 100)
shop_5 <- head(order(supermarket_data_clean$loyality_score_shop_5, decreasing = TRUE), 100)

```

__Observations:__
We generated a list of top 100 customers that spend the most amount of money in each of the 5 shops based on the loyality score described above and visualied it.

```{r echo=TRUE, message=FALSE}
## Create the legend for the plot
Legend <- c(rep("Shop 1", 5), rep("Shop 2", 5), rep("Shop 3", 5), rep("Shop 4", 5), rep("Shop 5", 5))

## Generate the count of columns assigned to each factor
amt_shop_1 <- supermarket_data_clean[head(shop_1, 5), "amount_purchased_shop_1"]
amt_shop_2 <- supermarket_data_clean[head(shop_2, 5), "amount_purchased_shop_2"]
amt_shop_3 <- supermarket_data_clean[head(shop_3, 5), "amount_purchased_shop_3"]
amt_shop_4 <- supermarket_data_clean[head(shop_4, 5), "amount_purchased_shop_4"]
amt_shop_5 <- supermarket_data_clean[head(shop_5, 5), "amount_purchased_shop_5"]

## Create a vector of values to be shown in the plot
values <- c(amt_shop_1, amt_shop_2, amt_shop_3, amt_shop_4, amt_shop_5)

## Create a vector of labels to be shown in the plot
labels <- factor(labels, levels = c(head(shop_1, 5), head(shop_2, 5), head(shop_3, 5), head(shop_4, 5), head(shop_5, 5)))

## Create a data frame to store the vectors
top_cust <- data.frame(labels, values)

## Generate a plot
tc_plot <- ggplot(top_cust, aes(labels, values))

## Add featurs to the plot
tc_plot + geom_bar(stat = "identity", aes(fill = Legend), width = 0.6) +
  xlab("Customer ID") + ylab("Amount spent") +
  ggtitle("Top 5 Customers for each Shop") +
  theme_bw() + scale_y_continuous(labels = scales::comma) + 
  theme(axis.text.x=element_text(angle=90, hjust=1))

```

__Applications:__ 
This would help business to identify the customers who contribute highly to reveneue of the respective shops, formulate reward schmes for them and in turn retain the high-value customer base.